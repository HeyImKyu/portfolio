---
title: Installing a new machine with my flakes
layout: page.njk
author: HeyImKyu
date: 2025-05-18
tags: [ 'pages', 'nixos' ]
description: This article is here to document the steps if I ever have to move to a new laptop again, because i just did that and it wasn't as straightforward as i thought it would be ^^"
img_src: "https://raw.githubusercontent.com/CharlotteCross1998/linuwux/refs/heads/main/nwixowos.svg"
img_alt: "nixos logo"
---

# Reason I'm doing this

Okay so, my laptop just died and i tried to just install a new NixOS 24.05 (because that was the version I originally used) and then build my flakes, but unfortunately it always failed with the same error message:

```bash
error: path ‘/nix/store/9y7z0wj024np8zrhwvpz6ph6ksckiwgy-linux-6.12.20-modules-shrunk/lib’ is not in the Nix store
```

# How do I fix this? :(

I found the solution to this problem <a class="link" href="https://discourse.nixos.org/t/issue-building-linux-kernel-modules-after-flake-update/62322">here</a>.

Simply just install NixOs 24.05, then run 

{% include "partials/copy_code.njk" %}

```bash
sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos
```

followed by

{% include "partials/copy_code.njk" %}

```bash
sudo nixos-rebuild-switch --upgrade
````

With that, the NixOs version should be on the newest unstable and can then be rebuilt using the flakes from my repo.

# Other considerations

One thing to also consider, is to copy the autogenerated hardware-config from `/etc/nixos/hardware-configuration.nix` to the flakes repo in `~/flakes/hosts/nixos/hardware-configuration.nix`.

Without this, NixOs will still not work ^^
